<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Séparer son site et son weblog propulsé par WordPress - z720.net
    </title>
    <link rel="alternate" href="http://z720.net/feed.xml" type="application/rss+xml" title="">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
  </head>
  <body>
    <header class="header">
      <div class="content-wrap">
        <h1>Séparer son site et son weblog propulsé par WordPress (archives)</h1>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><p>Le but de cet article est de permettre l'utilisation de WordPress comme un gestionnaire de contenu faisant apparaitre un site classique et un blog de manière distincte.</p>
<p><img src="http://v05.z720.net/blog/images/sitemap.png" alt="Exemple de plan du site" /></p>
<p>Avec cette solution l'arborescence des pages WordPress sont visibles à la racine du site alors que les articles du blog apparaisse dans un dossier nommé blog.</p>
<!--more-->
<p>Pour donner au weblog son propre répertoire dans l'arborescence des pages, il faut d'abord modifier les permaliens pour que les articles soient publiées dans un sous-répertoire en changeant la structure pour faire apparaitre un sous répertoire blog par exemple. La structure des permaliens devrait ressembler à ceci :  <a>/blog/%year%/%monthnum%/%day%/%postname%</a>.</p>
<p>Ensuite vous pourrez remarquer que si vous allez à l'adresse <a>http://www.votresite.com/blog</a> une erreur 404 va apparaitre. C'est parce que WordPress n'interprète pas ce répertoire comme l'accueil du weblog. Pour cela il faut ajouter une règle de redirection pour ce répertoire en utilisant le filtre <code>rewrite_rules_array</code> qui permet d'ajouter des règles de redirections. Nous allons donc utiliser les point d'entrés fournis par WordPress pour les plugins.</p>
<p>Dans un thème WordPress la page d'accueil du weblog utilise le gabarit <code>home.php</code> si celui-ci existe, sinon c'est le fichier <code>index.php</code> qui est utilisé. Nous allons ajouter une règle permettant à WordPress d'afficher un autre gabarit quand nous sommes sur l'accueil du site et de rediriger vers le gabarit de l'accueil classique du blog lorsque nous sommes dans notre répertoire <a>/blog/</a>.</p>
<p>Pour cela il faut ajouter un fichier <code>functions.php</code> dans le thème, si celui-ci n'existe pas déjà. Ainsi notre modification sera active pour notre thème uniquement et ne sera pas dépendante de l'activation ou non d'un plugin. Cela évite les mauvaises manipulations et de voir notre mise en page totalement désordonnées en cas de désactivation du plugin ou de changement de thème.</p>
<p>Il va falloir mettre en place 2 fonctions pour gérer cette fonctionnalité :</p>
<ul>
  <li>la première (<code>add_rules</code>) va permettre à WordPress de 
    reconnaitre notre dossier <a>/blog/</a> en l'assimilant à l'accueil de 
    la partie weblog
  </li>
  <li>la seconde (<code>template_redirect</code>) va permettre à WordPress 
    d'utiliser le fichier <code>homepage.php</code> comme gabarit de la 
    racine de notre site.
  </li>
</ul>
<p>Pour éviter que nos fonctions entrent en collision avec celles de WordPress, celles-ci seront encapsulées dans une classe. De la même manière que <a title="Bien développer un plugin pour WordPress" href="http://v05.z720.net/blog/archives/2006/03/28/bien-developper-un-plugin-pour-wordpress">je le préconise pour les plugins</a>.</p>
<pre class="php"><code>  function add_rules($rules) {
// Récupération des informations de redirections d'adresse
    global $wp_rewrite;
// Génération des liens pour les commentaires, pagination, etc.
    $new_rules = $wp_rewrite-&gt;generate_rewrite_rules($wp_rewrite-&gt;front);
// Génértation de la règle de redirection principale
    $global_home_rule = substr($wp_rewrite-&gt;front,1).'?';
    $new_rules[$global_home_rule] = "index.php";

// ajout des nouvelles règles de redirection
    $rules += $new_rules;
    return $rules;
  }

  function redirect() {
//Récupération du contexte
    global $wp;
// S'il s'agit de l'accueil et de la racine du site charger le gabarit homepage.php
    if(is_home() and ($wp-&gt;matched_rule == '')) {
      if(file_exists(dirname(__FILE__).'/homepage.php')) {
        include(dirname(__FILE__).'/homepage.php');
      } else {
        include(get_query_template('homepage'));
      }
// La page est affichée on sort
      exit;
    }
  }
</code></pre></section>
        </article>
      </div>
    </div>
    <footer>
      <section class="copy">
        <p>&copy; 1997-2013 z720 &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a>
        </p>
      </section>
    </footer>
  </body>
</html>